<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="Description" content="Enter your description here"/>
<link href="http://netdna.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="./css/Dashboard.css">
<title>Title</title>
</head>
<body>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <p id="logout">
      <a href="#" class="btn btn-info btn-lg" id="logout">
        <span class="glyphicon glyphicon-log-out"></span> Log out
      </a>
    </p> 
    
 
    <div class="container">
        <div class="row">
            <div class="col-xl-3 col-md-6">
                <div class="card bg-pattern">
                    <div class="card-body">
                        <div class="float-right">
                            <i class="fa fa-archive text-primary h4 ml-3"></i>
                        </div>
                     
                        <p class="text-muted mb-0">Employee</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card bg-pattern">
                    <div class="card-body">
                        <div class="float-right">
                            <i class="fa fa-th text-primary h4 ml-3"></i>
                        </div>
                       
                        <p class="text-muted mb-0">Admins</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card bg-pattern">
                    <div class="card-body">
                        <div class="float-right">
                            <i class="fa fa-file text-primary h4 ml-3"></i>
                        </div>
                        <p class="text-muted mb-0"> Dossiers</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card">
                    <div class="card-body">
                        <form>
                            <div class="form-group mb-0">
                                <label>Search</label>
                                <div class="input-group mb-0">
                                    <input type="text" class="form-control" placeholder="Search..." aria-describedby="project-search-addon" />
                                    <div class="input-group-append">
                                        <button class="btn btn-danger" type="button" id="project-search-addon"><i class="fa fa-search search-icon font-12"></i></button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
            </div>
        </div>
        <!-- end row -->
    
        <div class="row">
            <div class="col-lg-12">
                <div class="card"><br/>
                    <div class="text-center px-xl-3">
                        <button class="btn btn-success btn-block" type="button" data-toggle="modal" data-target="#user-form-modal">New User</button>
                      </div>
                    <div class="card-body">
                        <div class="table-responsive project-list">
                            <table class="table project-table table-centered table-nowrap">
                                <thead>
                                    <tr>
                                        
                                        <th scope="col">name</th>
                                        <th scope="col">email</th>
                                        <th scope="col">phone</th>
                                        <th scope="col">matricule</th>
                                                                              
                                    </tr>
                                </thead>

                                <tbody id="tbody">
                                </tbody>

                            </table>
                        </div>
                  
                    </div>
                </div>
            </div>
        </div>
        <!-- end row -->
    </div>

      <!-- User Form Modal -->
      <div class="modal fade" role="dialog" tabindex="-1" id="user-form-modal">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Create User</h5>
              <button type="button" id="close" class="close" data-dismiss="modal">
                <span aria-hidden="true">Ã—</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="py-1">
                <form class="form" novalidate="">
                  <div class="row">
                    <div class="col">
                      <div class="row">
                        <div class="col">
                          <div class="form-group">
                            <label>Name</label>
                            <input class="form-control" type="text" id="name" name="name" placeholder="name">
                          </div>
                        </div>
                        <div class="col">
                          <div class="form-group">
                            <label>phone</label>
                            <input class="form-control" type="text" id="phone" name="phone" placeholder="phone" >
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">
                          <div class="form-group">
                            <label>Email</label>
                            <input class="form-control" id="email" type="email" placeholder="user@example.com">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">
                          <div class="form-group">
                            <label>Matricule</label>
                            <input class="form-control" id="mat" type="text" placeholder="Matricule">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">
                          <div class="form-group">
                            <label>password</label>
                            <input class="form-control" id="password" type="password" placeholder="password">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col d-flex justify-content-end">

                      <button id="add" class="btn btn-primary" type="submit">Save Changes</button>
                    </div>
                  </div>
                </form>
</div>
</div>
</div>
</div>
</div>

<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.5.4/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta1/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    function parseJwt(token) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));

      return JSON.parse(jsonPayload);
    };

    var token = localStorage.getItem("x-auth-token");
    let data = parseJwt(token);
    console.log(data);

    axios.post('http://localhost:5000/employee/employee')
    .then(function (response) {
        console.log(response.data);
        var tbody = document.getElementById("tbody");
        var child = '';
        response.data.forEach(element => {
            child += '<tr>';
            child += "<td>"+element.name +"</td>";
            child += "<td>"+element.email +"</td>";
            child += "<td>"+element.phone +"</td>";
            child += "<td>";
            child += "<span class='text-success font-12'>";
            child += "<i class='mdi mdi-checkbox-blank-circle mr-1'></i>"+element.mat;
            child += "</span>"
            child += "</tr>";
        });
        tbody.innerHTML = child;
    })
    .catch(function (err) {
        console.log(err);
    });


    //add User

var add = document.getElementById("add");

add.addEventListener('click', () => {

var name = document.getElementById('name').value;
var email = document.getElementById('email').value;
var phone = document.getElementById('phone').value;
var mat = document.getElementById('mat').value;
var password = document.getElementById('password').value;
    
if(name =="" || email ==""|| phone ==""|| mat ==""|| password ==""){

    const myNotification = new Notification('Notification', {
            body: 'Ops somthing wrong'
          })
}
  
else 
    axios.post('http://localhost:5000/employee/',{

        name : name,
        email : email,
        phone : phone,
        mat : mat,
        password : password
    })
    .then(function (response){   

        const myNotification = new Notification('Notification', {
            body: 'User Added'
          })
    })

    .catch(function (err) {
        console.log(err);
    });
})
    var logout = document.getElementById("logout");
    logout.addEventListener('click', () => {
      localStorage.removeItem("x-auth-token");
      location.replace("index.html");
      const myNotification = new Notification('Notification', {
            body: 'User Logout'
          })

    })
  </script>
</body>
</html>